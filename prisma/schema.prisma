generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Reference to existing Athlete model in GoFast database
// Matches the structure from gofastapp-mvp and trainingmvp
model Athlete {
  id String @id @default(cuid())

  // Auth
  firebaseId String  @unique
  email      String?

  // Company Link (Single-tenant) - REQUIRED
  companyId String
  company   GoFastCompany @relation(fields: [companyId], references: [id])

  // Universal profile (optional fields - exist in DB but not all needed for F3)
  firstName    String?
  lastName     String?
  gofastHandle String?   @unique
  photoURL     String?
  phoneNumber  String?
  birthday     DateTime?
  gender       String?
  city         String?
  state        String?
  primarySport String?
  bio          String?
  instagram    String?

  // System fields
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations for F3 Invigorate
  attendanceRecords AttendanceRecord[]
  effortRecords     EffortRecord[]
  weeklyReflections WeeklyReflection[]
  selfReportEntries SelfReportEntry[]

  // Note: Many other fields exist in the actual database (training, Garmin, etc.)
  // but are not needed for F3 Invigorate relations
  @@map("athletes")
}

model GoFastCompany {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  address   String?
  city      String?
  state     String?
  zip       String?
  domain    String?

  // Relations
  athletes Athlete[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("go_fast_companies")
}

model AttendanceRecord {
  id        String   @id @default(cuid())
  athleteId String
  aoId      String
  date      DateTime
  source    AttendanceSource
  athlete   Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("attendance_records")
}

enum AttendanceSource {
  BACKBLAST
  SELF
}

model EffortRecord {
  id          String   @id @default(cuid())
  athleteId   String
  date        DateTime
  calories    Int
  durationSec Int
  calPerMin   Float
  athlete     Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("effort_records")
}

model WeeklyReflection {
  id        String   @id @default(cuid())
  athleteId String
  date      DateTime @default(now())
  mood      String?
  wins      String?
  struggles String?
  intention String?
  athlete   Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("weekly_reflections")
}

model SelfReportEntry {
  id          String            @id @default(cuid())
  athleteId   String
  date        DateTime          @default(now())
  category    SelfReportCategory
  note        String?
  athlete     Athlete            @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("self_report_entries")
}

enum SelfReportCategory {
  FELLOWSHIP
  SERVICE
  MARRIAGE_FAMILY
  DIET_QUEEN
  MENTAL_HEALTH
  SPIRITUAL
}

